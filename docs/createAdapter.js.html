<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: createAdapter.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: createAdapter.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const AdapterConfig = require('./AdapterConfig')
const { defaultConfig } = AdapterConfig

/**
 * 
 * @typedef {Object} PropertyOptions
 * @property {any} default property value to fall-out as default.
 * @property {AdapterOptions} items inner &lt;properties, options> map.
 */

/**
 * 
 * @typedef {Object.&lt;string, PropertyOptions>} AdapterOptions
 */

/**
 * 
 * @param {AdapterOptions} options schema for adapting resived objects with created adapter.
 * @param {AdapterConfig} adapterConfig configuration for adapter.
 *  @default AdapterConfig.defaultConfig default AdapterConfig object.
 * @returns {Function} adapter function to adapte objects with.
 */
function createAdapter(options, adapterConfig = defaultConfig) {
    if (!(adapterConfig instanceof AdapterConfig)) {
        throw new Error(`adapter config expect to be instance of class "AdapterConfig"`)
    }
    const {
        clearUndefineds,
        clearNulls,
    } = adapterConfig

    return (object) => {
        const fields = Object.keys(options)
        const adapted = {}
        for (let field of fields) {
            const fieldOptions = options[field]
            const fieldValue = object[field]

            adapted[field] = optionReducer(fieldOptions, adapterConfig)(fieldValue)

            if (clearUndefineds &amp;&amp; adapted[field] === undefined) {
                delete adapted[field]
            }
            if (clearNulls &amp;&amp; adapted[field] === null) {
                delete adapted[field]
            }
        }
        return adapted
    }
}

const optionReducer = (options, adapterConfig) => (object) => {
    const {
        toDefaults: {
            null: nullToDefault,
            undefined: undefinedToDefault,
        },
    } = adapterConfig

    let adapted = object
    // 1. if null || undefined and toDefautl === false
    if ((object === undefined &amp;&amp; !undefinedToDefault) || (object === null &amp;&amp; !nullToDefault)) {
        return adapted
    }

    // 2. set defaults if needed
    if (adapted === undefined || adapted === null) {
        if ('default' in options) {
            adapted = options.default
        }
    }
    // 3. if primitive return adapted
    if (adapted === null || typeof adapted !== 'object') {
        return adapted
    }

    // 4. if no items return object
    if (!('items' in options)) {
        return adapted
    }

    const adapter = createAdapter(options.items, adapterConfig)

    // 5. if Array
    if (adapted instanceof Array) {
        const adaptedArray = []
        for (let item of adapted) {
            adaptedArray.push(adapter(item))
        }
        return adaptedArray
    }

    // 6. if object
    return adapter(adapted)
}

module.exports = createAdapter</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AdapterConfig.html">AdapterConfig</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createAdapter">createAdapter</a></li><li><a href="global.html#createAdapterMiddleware">createAdapterMiddleware</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Tue Jun 09 2020 05:36:24 GMT+0400 (Armenia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
